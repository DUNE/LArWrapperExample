
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CollectionCreatorClass &#8212; LArWrapperExample 0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="usage.html" />
    <link rel="prev" title="What this package does" href="Intro.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usage.html" title="Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Intro.html" title="What this package does"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">LArWrapperExample 0.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CollectionCreatorClass</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="collectioncreatorclass">
<h1>CollectionCreatorClass<a class="headerlink" href="#collectioncreatorclass" title="Permalink to this heading">¶</a></h1>
<p>Replaces CollectionCreator</p>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this heading">¶</a></h2>
<p><cite>CollectionCreatorClass</cite> is a python script/class that takes a <cite>json</cite> specification for a dataset and makes both metacat datasets and sam definitions from it.</p>
<p>The query to create the dataset is the <cite>AND</cite> of the keys in the json file, with some additional qualifiers.  They include the ability to add selections on the time range  and runs and the addition of a tag so that you can version your datasets (for example as the Creator code changes).</p>
<p>samweb definitions are created with a name generated from the flags given in the json and command line.  They grow automatically as new fields meet the query criteria.</p>
<p>metacat datasets are created but do not grow unless you rerun the <cite>CollectionCreatorClass</cite> code with the <cite>–did</cite> argumennt.</p>
<p>The <cite>–did</cite> argument pulls the stored query from the pre-existing dataset and adds files matching that query.</p>
<p>metacat datasets also contain the query used to make them and a metadata field that contains the items used to make the dataset query.</p>
</div>
<div class="section" id="collectioncreatorclass-arguments">
<h2>CollectionCreatorClass arguments<a class="headerlink" href="#collectioncreatorclass-arguments" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage:<span class="w"> </span>CollectionCreatorClass.py<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--namespace<span class="w"> </span>NAMESPACE<span class="o">]</span><span class="w"> </span><span class="o">[</span>--user<span class="w"> </span>USER<span class="o">]</span>
<span class="w">                             </span><span class="o">[</span>--ordered<span class="w"> </span><span class="o">[</span>ORDERED<span class="o">]]</span><span class="w"> </span><span class="o">[</span>--json<span class="w"> </span>JSON<span class="o">]</span>
<span class="w">                             </span><span class="o">[</span>--did<span class="w"> </span>DID<span class="o">]</span><span class="w"> </span><span class="o">[</span>--test<span class="w"> </span><span class="o">[</span>TEST<span class="o">]]</span>

<span class="w">    </span>optional<span class="w"> </span>arguments:
<span class="w">    </span>-h,<span class="w"> </span>--help<span class="w">            </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>message<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<span class="w">    </span>--namespace<span class="w"> </span>NAMESPACE
<span class="w">                        </span>metacat<span class="w"> </span>namespace<span class="w"> </span><span class="k">for</span><span class="w"> </span>dataset
<span class="w">    </span>--user<span class="w"> </span>USER<span class="w">           </span>user<span class="w"> </span>name
<span class="w">    </span>--json<span class="w"> </span>JSON<span class="w">           </span>filename<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>json<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>parameters<span class="w"> </span>to<span class="w"> </span>and
<span class="w">    </span>--did<span class="w"> </span>DID<span class="w">             </span>&lt;namespace&gt;:&lt;name&gt;<span class="w"> </span><span class="k">for</span><span class="w"> </span>existing<span class="w"> </span>dataset<span class="w"> </span>to<span class="w"> </span>append<span class="w"> </span>to
<span class="w">    </span>--test<span class="w"> </span><span class="o">[</span>TEST<span class="o">]</span><span class="w">         </span><span class="k">do</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>mode
</pre></div>
</div>
</div>
<div class="section" id="collectioncreatorclass-api">
<h2>CollectionCreatorClass API<a class="headerlink" href="#collectioncreatorclass-api" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">CollectionCreatorClass.</span></span><span class="sig-name descname"><span class="pre">CollectionCreatorClass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass" title="Permalink to this definition">¶</a></dt>
<dd><p>Class to create data collections</p>
<p>__init__ initialization, does very little</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> – print out a lot of things</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">thedict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">did</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.load" title="Permalink to this definition">¶</a></dt>
<dd><p>load the information from the json dict into the class
does not change the db</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thedict</strong> – contents of input json description of collection</p></li>
<li><p><strong>did</strong> – id of a preexisting dataset to refill with new files</p></li>
</ul>
</dd>
</dl>
<p>calls make_name, make_query and make_sam_query</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.makeDataset">
<span class="sig-name descname"><span class="pre">makeDataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.makeDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.makeDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>actualy make the metacat dataset from information loaded into the class
does modify the db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.makeSamDefinition">
<span class="sig-name descname"><span class="pre">makeSamDefinition</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.makeSamDefinition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.makeSamDefinition" title="Permalink to this definition">¶</a></dt>
<dd><p>make a samweb definition from information loaded into the class and tranformed by make_sam_query
does modify the sam db unless the definition already exists</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.make_name">
<span class="sig-name descname"><span class="pre">make_name</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.make_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.make_name" title="Permalink to this definition">¶</a></dt>
<dd><p>create a name from template in json file. If none exists use a list of fields.
does not modify the db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.make_query">
<span class="sig-name descname"><span class="pre">make_query</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.make_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.make_query" title="Permalink to this definition">¶</a></dt>
<dd><p>build a metacat query if none exists already
does not modify the db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.make_sam_query">
<span class="sig-name descname"><span class="pre">make_sam_query</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.make_sam_query"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.make_sam_query" title="Permalink to this definition">¶</a></dt>
<dd><p>use the existing metacat query to make a sam query
does not modify the db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.printSummary">
<span class="sig-name descname"><span class="pre">printSummary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">results</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.printSummary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.printSummary" title="Permalink to this definition">¶</a></dt>
<dd><p>print a summary of metacat info in a nicer format
does not modify the db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.run" title="Permalink to this definition">¶</a></dt>
<dd><p>contact the db and actually generate the collection based on the data stored in the load phase
calls MakeDataSet and MakeSamDefinition
modifies the metacat db</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="CollectionCreatorClass.CollectionCreatorClass.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/CollectionCreatorClass.html#CollectionCreatorClass.setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#CollectionCreatorClass.CollectionCreatorClass.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>parse the arguments for the command line
does not modify the db</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="example-configuration-files">
<h2>Example configuration files<a class="headerlink" href="#example-configuration-files" title="Permalink to this heading">¶</a></h2>
<p>Example dataset configuration json files are in directory <cite>datasets</cite> and look like:</p>
<div class="section" id="for-simulation">
<h3>For simulation<a class="headerlink" href="#for-simulation" title="Permalink to this heading">¶</a></h3>
<p><cite>datasets/mctest.json</cite></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;mc files for HD&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;defnamespace&quot;</span><span class="p">:</span><span class="s2">&quot;schellma&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;defname&quot;</span><span class="p">:</span><span class="s2">&quot;%core.file_type%core.run_type%dune.campaign%core.application.version%core.data_tier%dune_mc.gen_fcl_filename%deftag&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.application.version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v09_75_03d00&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.data_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hit-reconstructed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.file_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.run_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fardet-hd&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dune.campaign&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fd_mc_2023a&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dune.requestid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ritm1780305&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dune_mc.beam_polarity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fhc&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dune_mc.gen_fcl_filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prodgenie_nutau_dune10kt_1x2x6.fcl&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;deftag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;testme7&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="for-data">
<h3>For data:<a class="headerlink" href="#for-data" title="Permalink to this heading">¶</a></h3>
<p><cite>datasets/pdtest.json</cite></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;test of data with runs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;defname&quot;</span><span class="p">:</span><span class="s2">&quot;core.file_type%core.run_type%dune.campaign%core.data_tier%core.data_stream%min_time%max_time%deftag&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.run_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;protodune-sp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.file_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;detector&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.data_tier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;full-reconstructed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;core.data_stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;physics&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dune.campaign&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PDSPProd4&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;min_time&quot;</span><span class="p">:</span><span class="s2">&quot;2021-01-03&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_time&quot;</span><span class="p">:</span><span class="s2">&quot;2022-10-03&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;runs&quot;</span><span class="p">:</span><span class="s2">&quot;5141:5143&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;deftag&quot;</span><span class="p">:</span><span class="s2">&quot;testme7&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="special-tags">
<h3>Special tags:<a class="headerlink" href="#special-tags" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>metacat fields with  % in them are normal metacat tags and are anded together to make the query.</p></li>
<li><p>fields such as <cite>max_time</cite>, <cite>min_time</cite> and <cite>runs</cite> have special metacat syntax so are flagged by the absence of a “.” and then interpreted by the script.</p></li>
<li><p>Special dataset tags include a <cite>defname</cite> template that allows you to build the dataset name from fields and a special tag <cite>deftag</cite> to allow multiple versions.</p></li>
<li><p>There is a <cite>description</cite> tag that allows you to describe your dataset.</p></li>
<li><p>the <cite>defname</cite> field allows you to specify a filename in which keys like <cite>%dune.campaign</cite> are replaced by the value of dune.campaign.  This allows you to avoid messing with defname every time you change a flag.</p></li>
</ul>
</div>
</div>
<div class="section" id="making-datasets">
<h2>Making datasets<a class="headerlink" href="#making-datasets" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p>a good way to make a dataset specification is to</p>
<ul class="simple">
<li><p>take metacat metadata from a file</p></li>
<li><p>strip out the selections that are not common to all files in the dataset</p></li>
<li><p>add a description, a name format and a deftag</p></li>
<li><p>store in new json file</p></li>
<li><p>run CollectionCreatorClass</p></li>
<li><p>the <cite>–test</cite> argument allows you to test without actually doing anything</p></li>
</ul>
</div></blockquote>
<p>The command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">CollectionCreatorClass</span> <span class="o">--</span><span class="n">json</span><span class="o">=</span><span class="n">datasets</span><span class="o">/</span><span class="n">pdtest</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>made a metacat dataset called:</p>
<p><cite>schellma:detector.protodune-sp.PDSPProd4.full-reconstructed.physics.5141-5143.2021-01-03.2022-10-03.testme7</cite></p>
<p>which you can find at:</p>
<p><a class="reference external" href="https://metacat.fnal.gov:9443/dune_meta_prod/app/gui/dataset?namespace=schellma&amp;name=schellma:detector.protodune-sp.PDSPProd4.full-reconstructed.physics.5141-5143.2021-01-03.2022-10-03.testme7">https://metacat.fnal.gov:9443/dune_meta_prod/app/gui/dataset?namespace=schellma&amp;name=schellma:detector.protodune-sp.PDSPProd4.full-reconstructed.physics.5141-5143.2021-01-03.2022-10-03.testme7</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">CollectionCreatorClass</span> <span class="o">--</span><span class="n">json</span><span class="o">=</span><span class="n">datasets</span><span class="o">/</span><span class="n">mctest</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>does similar for an mc sample and makes</p>
<p><cite>schellma:mc.fardet-hd.fd_mc_2023a.v09_75_03d00.hit-reconstructed.prodgenie_nutau_dune10kt_1x2x6.fcl.testme7</cite></p>
<p><a class="reference external" href="https://metacat.fnal.gov:9443/dune_meta_prod/app/gui/dataset?namespace=schellma&amp;name=mc.fardet-hd.fd_mc_2023a.v09_75_03d00.hit-reconstructed.prodgenie_nutau_dune10kt_1x2x6.fcl.testme7">https://metacat.fnal.gov:9443/dune_meta_prod/app/gui/dataset?namespace=schellma&amp;name=mc.fardet-hd.fd_mc_2023a.v09_75_03d00.hit-reconstructed.prodgenie_nutau_dune10kt_1x2x6.fcl.testme7</a></p>
</div>
<div class="section" id="adding-to-datasets">
<h2>Adding to datasets<a class="headerlink" href="#adding-to-datasets" title="Permalink to this heading">¶</a></h2>
<p><cite>metacat</cite> does not grow datasets automatically as <cite>samweb</cite> does, so if you want to add files to a dataset when new files arrive you can reuse the original query using the <cite>–did</cite> argument.  You can NOT do this by either never using the <cite>–did</cite> option or by using a date range in which case files created after a given date will not be added.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">CollectionCreatorClass</span> <span class="o">--</span><span class="n">did</span><span class="o">=</span><span class="n">schellma</span><span class="p">:</span><span class="n">detector</span><span class="o">.</span><span class="n">protodune</span><span class="o">-</span><span class="n">sp</span><span class="o">.</span><span class="n">PDSPProd4</span><span class="o">.</span><span class="n">full</span><span class="o">-</span><span class="n">reconstructed</span><span class="o">.</span><span class="n">physics</span><span class="mf">.2021</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mf">03.2022</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mf">03.</span><span class="n">testme7</span>
</pre></div>
</div>
</div>
<div class="section" id="example-of-using-the-python-api-from-a-python-script">
<span id="fd-mc-2023a-create"></span><h2>Example of using the python API from a python script<a class="headerlink" href="#example-of-using-the-python-api-from-a-python-script" title="Permalink to this heading">¶</a></h2>
<p><cite>fd_mc_2023a_create.py</cite> in the <cite>scripts</cite> directory is an example of using the <cite>CollectionCreatorClass</cite> python api instead of the command line.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">fd_mc_2023a_create</span> <span class="o">--</span><span class="n">make</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>will create (or update) several datasets based on a template.  This was made specifically for the fd_mc_2023a production.</p>
<p>You can find the datasets created by that script by typing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metacat</span> <span class="n">query</span> <span class="n">datasets</span> <span class="n">matching</span> <span class="n">schellma</span><span class="p">:</span><span class="o">*</span> <span class="n">having</span> <span class="n">datasetpar</span><span class="o">.</span><span class="n">deftag</span><span class="o">=</span><span class="n">prod_v4</span>
</pre></div>
</div>
<div class="section" id="fd-mc-2023a-create-script-example">
<h3>fd_mc_2023a_create script example<a class="headerlink" href="#fd-mc-2023a-create-script-example" title="Permalink to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="fd_mc_2023a_create.execute">
<span class="sig-prename descclassname"><span class="pre">fd_mc_2023a_create.</span></span><span class="sig-name descname"><span class="pre">execute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/fd_mc_2023a_create.html#execute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#fd_mc_2023a_create.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>code which uses CollectionCreatorClass to make datasets for a specific production</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test</strong> (<em>bool</em>) – just make a trial name and queries but don’t make the dataset</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – more printout</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="inspecting-and-finding-datasets-using-the-dataset-metadata-you-created">
<h2>Inspecting and finding datasets using the dataset metadata you created<a class="headerlink" href="#inspecting-and-finding-datasets-using-the-dataset-metadata-you-created" title="Permalink to this heading">¶</a></h2>
<div class="section" id="finding">
<h3>Finding<a class="headerlink" href="#finding" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metacat</span> <span class="n">query</span> <span class="n">datasets</span> <span class="n">matching</span> <span class="n">schellma</span><span class="p">:</span><span class="o">*</span> <span class="n">having</span> <span class="n">datasetpar</span><span class="o">.</span><span class="n">deftag</span><span class="o">=</span><span class="n">testme7</span>
</pre></div>
</div>
<p>finds all the datasets in namespace <cite>schellma</cite> that have <cite>deftag</cite> <cite>testme7</cite>.  You can search for any of the other parameters.</p>
</div>
<div class="section" id="inspecting">
<h3>Inspecting<a class="headerlink" href="#inspecting" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metacat</span> <span class="n">dataset</span> <span class="n">show</span> <span class="n">schellma</span><span class="p">:</span><span class="n">mc</span><span class="o">.</span><span class="n">fardet</span><span class="o">-</span><span class="n">hd</span><span class="o">.</span><span class="n">fd_mc_2023a</span><span class="o">.</span><span class="n">v09_75_03d00</span><span class="o">.</span><span class="n">hit</span><span class="o">-</span><span class="n">reconstructed</span><span class="o">.</span><span class="n">prodgenie_nutau_dune10kt_1x2x6</span><span class="o">.</span><span class="n">fcl</span><span class="o">.</span><span class="n">testme7</span>
</pre></div>
</div>
<p>produces</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Namespace</span><span class="p">:</span>             <span class="n">schellma</span>
<span class="n">Name</span><span class="p">:</span>                  <span class="n">mc</span><span class="o">.</span><span class="n">fardet</span><span class="o">-</span><span class="n">hd</span><span class="o">.</span><span class="n">fd_mc_2023a</span><span class="o">.</span><span class="n">v09_75_03d00</span><span class="o">.</span><span class="n">hit</span><span class="o">-</span><span class="n">reconstructed</span><span class="o">.</span><span class="n">prodgenie_nutau_dune10kt_1x2x6</span><span class="o">.</span><span class="n">fcl</span><span class="o">.</span><span class="n">testme7</span>
<span class="n">Description</span><span class="p">:</span>           <span class="n">mc</span> <span class="n">files</span> <span class="kn">from</span> <span class="nn">fd_mc_2023a</span>
<span class="n">Creator</span><span class="p">:</span>               <span class="n">schellma</span>
<span class="n">Created</span> <span class="n">at</span><span class="p">:</span>            <span class="mi">2023</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">19</span> <span class="mi">22</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">32</span> <span class="n">UTC</span>
<span class="n">Estimated</span> <span class="n">file</span> <span class="n">count</span><span class="p">:</span>  <span class="mi">20464</span>
<span class="n">Restricted</span><span class="p">:</span>            <span class="n">no</span>
<span class="n">Metadata</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s2">&quot;core.application.version&quot;</span><span class="p">:</span> <span class="s2">&quot;v09_75_03d00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;core.data_tier&quot;</span><span class="p">:</span> <span class="s2">&quot;hit-reconstructed&quot;</span><span class="p">,</span>
    <span class="s2">&quot;core.file_type&quot;</span><span class="p">:</span> <span class="s2">&quot;mc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;core.run_type&quot;</span><span class="p">:</span> <span class="s2">&quot;fardet-hd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;datasetpar.defname&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%c</span><span class="s2">ore.file_type</span><span class="si">%c</span><span class="s2">ore.run_type</span><span class="si">%d</span><span class="s2">une.campaign</span><span class="si">%c</span><span class="s2">ore.application.version</span><span class="si">%c</span><span class="s2">ore.data_tier</span><span class="si">%d</span><span class="s2">une_mc.gen_fcl_filename</span><span class="si">%d</span><span class="s2">eftag&quot;</span><span class="p">,</span>
    <span class="s2">&quot;datasetpar.defnamespace&quot;</span><span class="p">:</span> <span class="s2">&quot;schellma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;datasetpar.deftag&quot;</span><span class="p">:</span> <span class="s2">&quot;testme7&quot;</span><span class="p">,</span>
    <span class="s2">&quot;datasetpar.ordered&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;datasetpar.query&quot;</span><span class="p">:</span> <span class="s2">&quot;files where core.application.version=v09_75_03d00 and core.data_tier=&#39;hit-reconstructed&#39; and core.file_type=mc and core.run_type=&#39;fardet-hd&#39; and dune.campaign=fd_mc_2023a and dune.requestid=ritm1780305 and dune_mc.beam_polarity=fhc and dune_mc.gen_fcl_filename=prodgenie_nutau_dune10kt_1x2x6.fcl ordered &quot;</span><span class="p">,</span>
    <span class="s2">&quot;dune.campaign&quot;</span><span class="p">:</span> <span class="s2">&quot;fd_mc_2023a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dune.requestid&quot;</span><span class="p">:</span> <span class="s2">&quot;ritm1780305&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dune_mc.beam_polarity&quot;</span><span class="p">:</span> <span class="s2">&quot;fhc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dune_mc.gen_fcl_filename&quot;</span><span class="p">:</span> <span class="s2">&quot;prodgenie_nutau_dune10kt_1x2x6.fcl&quot;</span>
<span class="p">}</span>
<span class="n">Constraints</span><span class="p">:</span>
</pre></div>
</div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">CollectionCreatorClass</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#collectioncreatorclass-arguments">CollectionCreatorClass arguments</a></li>
<li><a class="reference internal" href="#collectioncreatorclass-api">CollectionCreatorClass API</a><ul>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass</span></code></a><ul>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.load"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.load()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.makeDataset"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.makeDataset()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.makeSamDefinition"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.makeSamDefinition()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.make_name"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.make_name()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.make_query"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.make_query()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.make_sam_query"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.make_sam_query()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.printSummary"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.printSummary()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.run"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.run()</span></code></a></li>
<li><a class="reference internal" href="#CollectionCreatorClass.CollectionCreatorClass.setup"><code class="docutils literal notranslate"><span class="pre">CollectionCreatorClass.setup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example-configuration-files">Example configuration files</a><ul>
<li><a class="reference internal" href="#for-simulation">For simulation</a></li>
<li><a class="reference internal" href="#for-data">For data:</a></li>
<li><a class="reference internal" href="#special-tags">Special tags:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#making-datasets">Making datasets</a></li>
<li><a class="reference internal" href="#adding-to-datasets">Adding to datasets</a></li>
<li><a class="reference internal" href="#example-of-using-the-python-api-from-a-python-script">Example of using the python API from a python script</a><ul>
<li><a class="reference internal" href="#fd-mc-2023a-create-script-example">fd_mc_2023a_create script example</a><ul>
<li><a class="reference internal" href="#fd_mc_2023a_create.execute"><code class="docutils literal notranslate"><span class="pre">execute()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#inspecting-and-finding-datasets-using-the-dataset-metadata-you-created">Inspecting and finding datasets using the dataset metadata you created</a><ul>
<li><a class="reference internal" href="#finding">Finding</a></li>
<li><a class="reference internal" href="#inspecting">Inspecting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Intro.html"
                          title="previous chapter">What this package does</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="usage.html"
                          title="next chapter">Usage</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/CollectionCreatorClass.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usage.html" title="Usage"
             >next</a> |</li>
        <li class="right" >
          <a href="Intro.html" title="What this package does"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">LArWrapperExample 0.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CollectionCreatorClass</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Fermi National Accelerator Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>