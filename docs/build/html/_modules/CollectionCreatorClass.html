<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CollectionCreatorClass &#8212; LArWrapperExample 0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css?v=8fc2db88" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=d7c963c3"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">LArWrapperExample 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CollectionCreatorClass</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for CollectionCreatorClass</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;metacat CollectionCreatorClass&quot;&quot;&quot;</span>
<span class="c1">##</span>
<span class="c1"># @mainpage CollectionCreatorClass</span>
<span class="c1">#</span>
<span class="c1"># @section description_main  </span>
<span class="c1">#</span>
<span class="c1">#  You can invoke this with python CollectionCreatorClass --json=&lt;json with list of required field values&gt;</span>
<span class="c1"># optional arguments are --min_time (earliest date)  --max_time (latest date)</span>
<span class="c1">##</span>
<span class="c1"># @file CollectionCreatorClass.py</span>


<span class="kn">from</span> <span class="nn">ctypes.wintypes</span> <span class="kn">import</span> <span class="n">tagSIZE</span>
<span class="kn">import</span> <span class="nn">samweb_client</span>
<span class="n">samweb</span> <span class="o">=</span> <span class="n">samweb_client</span><span class="o">.</span><span class="n">SAMWebClient</span><span class="p">(</span><span class="n">experiment</span><span class="o">=</span><span class="s1">&#39;dune&#39;</span><span class="p">)</span>

 
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span> <span class="k">as</span> <span class="n">ap</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">metacat.webapi</span> <span class="kn">import</span> <span class="n">MetaCatClient</span> 
<span class="n">mc_client</span> <span class="o">=</span> <span class="n">MetaCatClient</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;METACAT_SERVER_URL&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="CollectionCreatorClass"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass">[docs]</a><span class="k">class</span> <span class="nc">CollectionCreatorClass</span><span class="p">:</span>

    <span class="c1">## initiatization - does very little</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># actual name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (namespace+defname)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># (list of tags)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># metacat query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samquery</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># translation of metaquery into sam language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;USER&quot;</span><span class="p">)</span> <span class="c1"># default is person running the script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    
    <span class="c1">## set up from another script by using a dictionary or a did name  -- parallels the command line</span>

<div class="viewcode-block" id="CollectionCreatorClass.load"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">did</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">dict</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">did</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no dictionary or dataset name provided - perhaps you want to use the --json or --did argument to specify on command line&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>

        <span class="c1"># this inputs a did</span>
        <span class="k">if</span> <span class="n">did</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">=</span> <span class="n">did</span>
            <span class="n">stuff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stuff</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;did&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">,</span> <span class="s2">&quot;has invalid format&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;getting namespace from --did&quot;</span><span class="p">,</span> <span class="n">stuff</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">mc_client</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;failure finding information for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

            <span class="k">if</span> <span class="s2">&quot;datasetpar.query&quot;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="s2">&quot;datasetpar.query&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;could not find a query in the dataset metadata for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;this only works for datasets made with CollectionCreatorClass&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">dict</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="nb">dict</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">make_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_query</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_sam_query</span><span class="p">()</span></div>

<div class="viewcode-block" id="CollectionCreatorClass.run"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">did</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;need to run load first to get name or did&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#self.load(self,dict = None, did = None, namespace = None, test = False)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">makeDataset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">makeSamDataset</span><span class="p">()</span></div>
        

        

        
        

    <span class="c1">## create a name from template in json file. If none exists use a list of fields. </span>
<div class="viewcode-block" id="CollectionCreatorClass.make_name"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.make_name">[docs]</a>    <span class="k">def</span> <span class="nf">make_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;----------------------------&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;make a name for this dataset&quot;</span><span class="p">)</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">,</span><span class="s2">&quot;defname&quot;</span><span class="p">,</span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span><span class="s2">&quot;ordered&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;defname&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;defname&quot;</span><span class="p">]</span>
            <span class="n">namekeys</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="n">namekeys</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">extend</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span><span class="o">+</span><span class="n">x</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;extend&quot;</span><span class="p">,</span><span class="n">extend</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">extend</span> <span class="ow">in</span> <span class="n">template</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">extend</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;keyword &quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;not in defname, are you sure?&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">template</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;unrecognized tag in defname&quot;</span><span class="p">,</span><span class="n">template</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># for x in namekeys:</span>
            <span class="c1">#     if DEBUG: print (x)</span>
            <span class="c1">#     if x == &#39;&#39;: continue</span>
            <span class="c1">#     if x in self.meta.keys():</span>
            <span class="c1">#         if self.meta[x] == None:</span>
            <span class="c1">#             template = template.replace(x,&quot;none&quot;)</span>
            <span class="c1">#         else:</span>
            <span class="c1">#             template = template.replace(x,self.meta[x])</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         print (&quot;asked for a string in the name that is not in the definition&quot;,x)</span>
            <span class="c1">#         sys.exit(1)</span>
            
            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="c1"># protect against &quot;:&quot; for ranges</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="c1"># protect against &quot;,&quot; in lists</span>
            <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span> <span class="n">template</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;dataset name will be: &quot;</span><span class="p">,</span><span class="n">template</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">template</span>
        
            
            


        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;core.run_type&quot;</span><span class="p">,</span><span class="s2">&quot;dune.campaign&quot;</span><span class="p">,</span><span class="s2">&quot;core.file_type&quot;</span><span class="p">,</span><span class="s2">&quot;core.data_tier&quot;</span><span class="p">,</span><span class="s2">&quot;core.data_stream&quot;</span><span class="p">,</span><span class="s2">&quot;dune_mc.gen_fcl_filename&quot;</span><span class="p">,</span><span class="s2">&quot;core.application.version&quot;</span><span class="p">,</span><span class="s2">&quot;min_time&quot;</span><span class="p">,</span><span class="s2">&quot;max_time&quot;</span><span class="p">,</span><span class="s2">&quot;deftag&quot;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.fcl&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;max_time&quot;</span><span class="p">:</span>
                        <span class="n">new</span> <span class="o">=</span><span class="s2">&quot;le&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;min_time&quot;</span><span class="p">:</span>
                        <span class="n">new</span> <span class="o">=</span><span class="s2">&quot;ge&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">metas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;deftag&quot;</span><span class="p">:</span>
                        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="n">new</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;__&quot;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;name will be&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

    <span class="c1">## make a metacat query from the AND of the json inputs</span>

<div class="viewcode-block" id="CollectionCreatorClass.make_query"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.make_query">[docs]</a>    <span class="k">def</span> <span class="nf">make_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;---------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;make or find a metacat query&quot;</span><span class="p">)</span>
        <span class="c1"># skip if already set (generally by did)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;found a query&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;files where&quot;</span>
        
        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;Comment&quot;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DEBUG</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="c1"># put quotes around values that have &quot;-&quot; in them because metacat doesn&#39;t interpret &quot;-&quot; well</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">val</span>
 
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; and&quot;</span>
            
        <span class="c1"># strip off the last &quot;and&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DEBUG</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="n">query</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="s2">&quot;runs&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;runs&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
                <span class="n">runs</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">runs</span>
            <span class="n">rquery</span> <span class="o">=</span> <span class="s2">&quot; and core.runs[any] in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">runs</span>
             
            <span class="n">query</span> <span class="o">+=</span> <span class="n">rquery</span>

        <span class="c1"># do time range - takes some work as there are two possibilities</span>

        <span class="nb">min</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s2">&quot;min_time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;min_time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="nb">min</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;max_time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;max_time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="nb">max</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">max</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">min</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">min</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;min_time&quot;</span><span class="p">]</span>
                    
            <span class="k">if</span> <span class="nb">max</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;max_time&quot;</span><span class="p">]</span>
                
            
            <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;created_timestamp&quot;</span>
            
            <span class="n">timequery</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> 
            
            
            <span class="k">if</span> <span class="nb">min</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">timequery</span> <span class="o">+=</span> <span class="s2">&quot; and </span><span class="si">%s</span><span class="s2"> &gt;= &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="nb">min</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">max</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">timequery</span> <span class="o">+=</span> <span class="s2">&quot; and </span><span class="si">%s</span><span class="s2"> &lt;= &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="nb">max</span><span class="p">)</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="n">timequery</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;No time range set, use all files&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; ordered &quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span> <span class="o">=</span> <span class="n">query</span></div>
        

    <span class="c1">## convert a metacat query into a sam query</span>

<div class="viewcode-block" id="CollectionCreatorClass.make_sam_query"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.make_sam_query">[docs]</a>    <span class="k">def</span> <span class="nf">make_sam_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;-------------------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;make a samweb query&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; no metacat query to make sam query from&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;where&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># convert some fields</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;core.&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;dune_mc.&quot;</span><span class="p">,</span><span class="s2">&quot;DUNE_MC.&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;dune.&quot;</span><span class="p">,</span><span class="s2">&quot;DUNE.&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;application.&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;runs[any] in&quot;</span><span class="p">,</span><span class="s2">&quot;run_number&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ordered&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;created_timestamp&quot;</span><span class="p">,</span><span class="s2">&quot;create_date&quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;limit &quot;</span><span class="p">,</span><span class="s2">&quot; with limit &quot;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s2">&quot; availability:anylocation and &quot;</span> <span class="o">+</span> <span class="n">r</span>
        <span class="c1"># if (&quot;skip&quot; in r): print (&quot;skip doesn&#39;t work yet in sam&quot;)</span>
        <span class="c1"># print (&quot;samweb list-files --summary \&quot;&quot;, r, &quot;\&quot;&quot;)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;samquery&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samquery</span> <span class="o">=</span> <span class="n">r</span></div>

    <span class="c1">## parse sys.argv and either get existing query or read json and make a new query/dataset</span>
<div class="viewcode-block" id="CollectionCreatorClass.setup"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">ap</span><span class="p">()</span>
            
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--namespace&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;USER&quot;</span><span class="p">),</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;metacat namespace for dataset&quot;</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--user&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;user name&#39;</span><span class="p">)</span>

            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--json&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;filename for a json list of parameters to and&#39;</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--did&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;&lt;namespace&gt;:&lt;name&gt; for existing dataset to append to&quot;</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--test&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;do in test mode&#39;</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;print out a lot&#39;</span><span class="p">)</span>
           
            <span class="n">XtraTags</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="n">args</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;USER&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="n">args</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;USER&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">namespace</span>

            <span class="c1"># check if using prexisting did - if so reuse existing query</span>

            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">json</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">did</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no json or did file, in future you will be able to append to a dataset directly&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># yes this is pre-existing dataset</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">did</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">did</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">did</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">did</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># read the data description tags from json file</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">json</span><span class="p">):</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;json file&quot;</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">json</span><span class="p">,</span><span class="s2">&quot; does not exist, quitting&quot;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">json</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">Tags</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">Tags</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">dict</span><span class="o">=</span><span class="n">Tags</span><span class="p">,</span><span class="n">test</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;could not open&quot;</span><span class="p">,</span><span class="n">args</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

                
                
            <span class="c1">#     if f:</span>
            <span class="c1">#         Tags = json.load(f)</span>
            <span class="c1">#     for x in required:</span>
            <span class="c1">#         if x not in Tags:</span>
            <span class="c1">#             print(&quot;This constraint is required for all DUNE data&quot;, x)</span>
            <span class="c1">#             sys.exit(1)</span>

            <span class="c1">#         self.did = args.did</span>
            <span class="c1">#         stuff = self.did.split(&quot;:&quot;)</span>
            <span class="c1">#         if DEBUG: print (&quot;did&quot;,stuff)</span>
            <span class="c1">#         if len(stuff)!=2:</span>
            <span class="c1">#             print (&quot;did&quot;, self.did, &quot;has invalid format&quot;)</span>
            <span class="c1">#             sys.exit(1)</span>
            <span class="c1">#         if self.namespace == os.getenv(&quot;USER&quot;):</span>
            <span class="c1">#             print (&quot;getting namespace from --did&quot;, stuff[0])</span>
            <span class="c1">#             self.namespace = stuff[0]</span>
            <span class="c1">#         self.name = stuff[1]</span>
            <span class="c1">#         info = mc_client.get_dataset(self.did)</span>
            <span class="c1">#         self.info = info</span>
            <span class="c1">#         if DEBUG: print(json.dumps(info,indent=4))</span>

            <span class="c1">#         if &quot;datasetpar.query&quot; in info[&quot;metadata&quot;]:</span>
            <span class="c1">#             if DEBUG: print (&quot;found the query&quot;, info[&quot;metadata&quot;][&quot;datasetpar.query&quot;])</span>
            <span class="c1">#             self.metaquery = info[&quot;metadata&quot;][&quot;datasetpar.query&quot;]</span>
            <span class="c1">#         else:</span>
            <span class="c1">#                 print (&quot;could not find a query in the dataset metadata for &quot;, self.did, info)</span>
            <span class="c1">#                 print (&quot;this only works for datasets made with CollectionCreatorClass&quot;)</span>
            <span class="c1">#                 sys.exit(1)</span>

            <span class="c1">#     self.meta = None  # tell program you did not read json file</span>
                    
    
            <span class="c1"># else:</span>
            <span class="c1"># # read the data description tags from json file</span>
            <span class="c1">#     if not os.path.exists(args.json):</span>
            <span class="c1">#         print (&quot;json file&quot;,args.json,&quot; does not exist, quitting&quot;)</span>
            <span class="c1">#         sys.exit(1)</span>
            <span class="c1">#     f = open(args.json,&#39;r&#39;)</span>
            <span class="c1">#     required = [&quot;core.file_type&quot;, &quot;core.run_type&quot;]</span>
                
            <span class="c1">#     if f:</span>
            <span class="c1">#         Tags = json.load(f)</span>
            <span class="c1">#     for x in required:</span>
            <span class="c1">#         if x not in Tags:</span>
            <span class="c1">#             print(&quot;This constraint is required for all DUNE data&quot;, x)</span>
            <span class="c1">#             sys.exit(1)</span>
            <span class="c1">#     </span>
            <span class="c1">#     if DEBUG: print (Tags)</span>
            <span class="c1">#     self.metaquery = None  # fill in later</span>
            <span class="c1">#     self.meta = Tags</span>
            <span class="c1">#     self.did = None # tell program you got info from json</span>
                
            <span class="c1"># self.test = args.test      </span>
            
    <span class="c1">## just a nice reformatting of results</span>

<div class="viewcode-block" id="CollectionCreatorClass.printSummary"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.printSummary">[docs]</a>    <span class="k">def</span> <span class="nf">printSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">results</span><span class="p">):</span>
        <span class="n">nfiles</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">nfiles</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">total_size</span> <span class="o">+=</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files:       &quot;</span><span class="p">,</span> <span class="n">nfiles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_size</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;TB&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">total_size</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">total_size</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;MB&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">total_size</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;KB&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">/</span> <span class="mi">1024</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">total_size</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matacat files: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">nfiles</span><span class="p">,</span> <span class="s2">&quot;Total size:  &quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> (</span><span class="si">%.3f</span><span class="s2"> </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_size</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span></div>
    
    <span class="c1">## use the query from make_query to make a metacat dataset</span>

<div class="viewcode-block" id="CollectionCreatorClass.makeDataset"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.makeDataset">[docs]</a>    <span class="k">def</span> <span class="nf">makeDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;---------------------------&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;try to make a metacat dataset&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
             <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;ERROR: need to run make_query or supply an input dataset first&quot;</span><span class="p">)</span>
             <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


        
        <span class="c1"># already have a dataset - just want to update it</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;add files to existing dataset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
                <span class="n">mc_client</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">,</span><span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;this was just a test with an existing dataset&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># need to make dataset metadata from json input in self.meta</span>

        <span class="n">cleanmeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># move dataset creation flags into dataset....</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> <span class="c1"># we have some extra parameters - need to store properly</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;rename search params that are not . type&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>  <span class="c1"># this goes in the real description field so skip</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cleanmeta</span><span class="p">:</span><span class="n">cleanmeta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">cleanmeta</span><span class="p">[</span><span class="s2">&quot;datasetpar.&quot;</span><span class="o">+</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cleanmeta</span><span class="p">:</span><span class="n">cleanmeta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cleanmeta</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;remove null key&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cleanmeta</span><span class="p">:</span> <span class="n">cleanmeta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleanmeta</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="n">cleanmeta</span><span class="p">)</span>

        <span class="c1"># store the query used to make this dataset for future reuse</span>
        <span class="n">cleanmeta</span><span class="p">[</span><span class="s2">&quot;datasetpar.query&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span>

        <span class="n">did</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">already</span> <span class="o">=</span> <span class="n">mc_client</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no dataset of this name yet, make one&quot;</span><span class="p">)</span>
            <span class="n">already</span> <span class="o">=</span> <span class="kc">None</span>

        

        <span class="k">if</span> <span class="n">already</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;make a new dataset&quot;</span><span class="p">,</span><span class="n">did</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="p">)</span>
            <span class="c1">#try:</span>
                <span class="n">mc_client</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">did</span><span class="p">,</span><span class="n">files_query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span><span class="n">metadata</span><span class="o">=</span><span class="n">cleanmeta</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">=</span> <span class="n">did</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">mc_client</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;made dataset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1">#return 1</span>
    <span class="c1">#        except:</span>
    <span class="c1">#            print(&quot;metacat dataset creation failed - does it already exist?&quot;)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># already there</span>
               
                <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span><span class="n">already</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;add files to existing dataset&quot;</span><span class="p">,</span><span class="n">did</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;query was&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="p">)</span>
                <span class="c1">#try:</span>
                <span class="n">mc_client</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span><span class="n">did</span><span class="p">,</span><span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metaquery</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">mc_client</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">did</span> <span class="o">=</span> <span class="n">did</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;extended dataset&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">did</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

                <span class="c1">#except:</span>
                <span class="c1">#    print(&quot;metacat dataset addition failed - does it already exist?&quot;)</span>
        
    <span class="c1">## make a samweb dataset</span>

<div class="viewcode-block" id="CollectionCreatorClass.makeSamDataset"><a class="viewcode-back" href="../Modules.html#CollectionCreatorClass.CollectionCreatorClass.makeSamDataset">[docs]</a>    <span class="k">def</span> <span class="nf">makeSamDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># do some sam stuff</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;make sam definition&quot;</span><span class="p">)</span>
        <span class="n">defname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;USER&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Try to make a sam definition:&quot;</span><span class="p">,</span><span class="n">defname</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">samweb</span><span class="o">.</span><span class="n">listFilesSummary</span><span class="p">(</span><span class="s2">&quot;defname:&quot;</span><span class="o">+</span><span class="n">defname</span><span class="p">)</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;samweb status&quot;</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span>  <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;samweb definition already exists&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no such definition exists, need to make it&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no such samweb definition exists, need to make it&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">samquery</span> <span class="o">!=</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">samweb</span><span class="o">.</span><span class="n">createDefinition</span><span class="p">(</span><span class="n">defname</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samquery</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samquery</span><span class="p">)</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;made samweb definition&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defname</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;failed to make sam definition</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div></div>
        
    


<span class="c1">## command line, explains the variables.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
   
    <span class="n">creator</span> <span class="o">=</span> <span class="n">CollectionCreatorClass</span><span class="p">()</span>
    
    <span class="c1"># read in command line args</span>
    <span class="n">creator</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">creator</span><span class="o">.</span><span class="n">verbose</span>
    <span class="c1"># dump out information </span>

    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">------------------------&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> samweb query&quot;</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;samweb list-files --summary </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">creator</span><span class="o">.</span><span class="n">samquery</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">samweb</span><span class="o">.</span><span class="n">listFilesSummary</span><span class="p">(</span><span class="n">creator</span><span class="o">.</span><span class="n">samquery</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;SAM got here&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SAM FILES&quot;</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">------------------------&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> metacat query&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;metacat query </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">creator</span><span class="o">.</span><span class="n">metaquery</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">query_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mc_client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">creator</span><span class="o">.</span><span class="n">metaquery</span><span class="p">))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="n">creator</span><span class="o">.</span><span class="n">printSummary</span><span class="p">(</span><span class="n">query_files</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ------------------------&quot;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">verbose</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> dataset metadata&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">creator</span><span class="o">.</span><span class="n">meta</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;dataset.meta&quot;</span><span class="p">:</span><span class="n">creator</span><span class="o">.</span><span class="n">meta</span><span class="p">},</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">creator</span><span class="o">.</span><span class="n">did</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">creator</span><span class="o">.</span><span class="n">info</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ------------------------&quot;</span><span class="p">)</span>
    
 
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">LArWrapperExample 0.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CollectionCreatorClass</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, Fermi National Accelerator Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    </div>
  </body>
</html>